<?xml version="1.0" encoding="utf-8"?>
<mx:VBox 
	xmlns:mx="http://www.adobe.com/2006/mxml" 
	xmlns:mlc="com.matlabulchifai.components.views.*" 
	width="100%" 
	height="100%" 
	label="New Patient"
	horizontalAlign="center">
	
	<mx:Metadata>
		[Event(name="patientCreate", type="com.matlabulchifai.events.patient.PatientEvent")]
	</mx:Metadata>
	
	<mx:Script>
		<![CDATA[
			
		import mx.rpc.events.ResultEvent;
		import com.matlabulchifai.events.patient.PatientEvent;
		import mx.controls.Alert;
		import mx.managers.FocusManager;
		import mx.collections.ArrayCollection;
		
		[Bindable]
		public var test:PatientGridBox;
		[Bindable]
		private var currDate:Date = new Date();
		
		[Bindable]
        public var genders:ArrayCollection = new ArrayCollection(
            [ {label:"Male", data:"Male"}, 
			  {label:"Female", data:"Female"}]);

		private function handleNewPatientResult(event:ResultEvent):void{
			var resultXML:XML = XML(event.result);
			Matlabulchifai.debug("patient created = \n" + resultXML);
			dispatchEvent(new PatientEvent(PatientEvent.PATIENT_CREATE, resultXML));
			clearForm();		
		}
		
		private function doPatientCreate():void{
			svcPatientCreate.send();
			//this.verticalScrollPosition = 0;
		}
		
		private function clearForm():void{
			medicalrecordTI.text = "";
			firstnameTI.text = "";
			middlenameTI.text = "";
			lastnameTI.text = "";
			arrivaldateTI.text = "";
			birthdateTI.text = "";
			genderTI.text = "";
			addressTI.text = "";
			cityTI.text = "";
			stateTI.text = "";
			zipTI.text = "";
			telephoneTI.text = "";
			fatherfirstnameTI.text = "";
			fatherlastnameTI.text = "";
			motherfirstnameTI.text = "";
			motherlastnameTI.text = "";
			emergencycontactnameTI.text = "";
			emergencycontactrelationshipTI.text = "";
			patientremarksTI.text = "";
			//refocus back on the first field
			focusManager.setFocus(medicalrecordTI);
		}
		
		
		
		]]>
	</mx:Script>
		<mx:HTTPService
			id="svcPatientCreate"
			url="/patients.xml"
			resultFormat="e4x"
			contentType="application/xml"
			method="POST"
			result="handleNewPatientResult(event)">
			<mx:request>
				<patient>
					<active>true</active>
					<medical_record_number>{medicalrecordTI.text}</medical_record_number>
					<first_name>{firstnameTI.text}</first_name>
					<middle_name>{middlenameTI.text}</middle_name>
					<last_name>{lastnameTI.text}</last_name>
					<arrival_date>{arrivaldateTI.text}</arrival_date>
					<date_of_birth>{birthdateTI.text}</date_of_birth>
					<gender>{genderTI.text}</gender>
					<address>{addressTI.text}</address>
					<city>{cityTI.text}</city>
					<state>{stateTI.text}</state>
					<zip>{zipTI.text}</zip>
					<telephone>{telephoneTI.text}</telephone>
					<father_first_name>{fatherfirstnameTI.text}</father_first_name>
					<father_last_name>{fatherlastnameTI.text}</father_last_name>
					<mother_first_name>{motherfirstnameTI.text}</mother_first_name>
					<mother_last_name>{motherlastnameTI.text}</mother_last_name>
					<emergency_contact_name>{emergencycontactnameTI.text}</emergency_contact_name>
					<emergency_contact_relationship>{emergencycontactrelationshipTI.text}</emergency_contact_relationship>
					<patient_remarks>{patientremarksTI.text}</patient_remarks>
				</patient>
			</mx:request>
		</mx:HTTPService>
		
	<mx:Panel title="Add Patient" horizontalAlign="center">
		<mx:Form id="patientForm" textAlign="left">
				<mx:FormItem required="true" label="Medical Record ID">
					<mx:TextInput id="medicalrecordTI"/>
				</mx:FormItem>
				
				<mx:FormItem required="true" label="First Name">
					<mx:TextInput id="firstnameTI"/>
				</mx:FormItem>
				
				<mx:FormItem label="Middle Name">
					<mx:TextInput id="middlenameTI"/>
				</mx:FormItem>
				
				<mx:FormItem required="true" label="Last Name">
					<mx:TextInput id="lastnameTI"/>
				</mx:FormItem>
				
				<mx:FormItem required="true" label="Arrival Date">
					<mx:DateField id="arrivaldateTI" yearNavigationEnabled="true" minYear="1930" maxYear="{currDate.getFullYear()}" />
				</mx:FormItem>
				
				<mx:FormItem required="true" label="Date of Birth">
					<mx:DateField id="birthdateTI" yearNavigationEnabled="true" minYear="1930" maxYear="{currDate.getFullYear()}" 
						displayedMonth="0" displayedYear="1990" showToday="false" />
				</mx:FormItem>
				
				<mx:FormItem label="Gender">
					<mx:ComboBox id="genderTI" dataProvider="{genders}"/>
				</mx:FormItem>
				
				<mx:FormItem label="Address">
					<mx:TextInput id="addressTI"/>
				</mx:FormItem>
	
				<mx:FormItem label="City">
					<mx:TextInput id="cityTI"/>
				</mx:FormItem>
				
				
				<mx:FormItem label="State">
					<mx:TextInput id="stateTI"/>
				</mx:FormItem>
				
				<mx:FormItem label="Zip">
					<mx:TextInput id="zipTI"/>
				</mx:FormItem>
				
				<mx:FormItem label="Telephone">
					<mx:TextInput id="telephoneTI"/>
				</mx:FormItem>
				
				<mx:FormItem label="Father First Name">
					<mx:TextInput id="fatherfirstnameTI"/>
				</mx:FormItem>
				
				<mx:FormItem label="Father Last Name">
					<mx:TextInput id="fatherlastnameTI"/>
				</mx:FormItem>
				
				<mx:FormItem label="Mother First Name">
					<mx:TextInput id="motherfirstnameTI"/>
				</mx:FormItem>
				
				<mx:FormItem label="Mother Last Name">
					<mx:TextInput id="motherlastnameTI"/>
				</mx:FormItem>
				
				<mx:FormItem label="Emergency Contact Name">
					<mx:TextInput id="emergencycontactnameTI"/>
				</mx:FormItem>
				
				<mx:FormItem label="Emergency Contact Relationship">
					<mx:TextInput id="emergencycontactrelationshipTI"/>
				</mx:FormItem>
				
				<mx:FormItem label="Patient Remarks">
					<mx:TextInput id="patientremarksTI"/>
				</mx:FormItem>
				
				
				<mx:FormItem>
					<mx:Button id="createBtn" label="Create"
						click="doPatientCreate()"/>
				</mx:FormItem>
				
		</mx:Form>
	</mx:Panel>
</mx:VBox>