<?xml version="1.0" encoding="utf-8"?>
<mx:VBox 
	xmlns:mx="http://www.adobe.com/2006/mxml" 
	width="100%" 
	height="100%"
    label="Search"
    creationComplete="search()">
	
<mx:Script>
<![CDATA[
    import mx.controls.Alert;
    import mx.rpc.events.ResultEvent;
	
    private function search():void {
    	if (searchTI.text == "") {
    		svcSearch.url = "/patients.xml";
    	} else {
    		svcSearch.url = "/searches/" + searchTI.text + ".xml";
    	}
    	
    	svcSearch.send();
    }
    
    private function showAll():void {
    	svcSearch.url = "/patients.xml";
    	svcSearch.send();
    }
    
    private function handleSearchListResult(event:ResultEvent):void {
		var resultXML: XML = XML(event.result);
		Matlabulchifai.debug("search result = \n" + resultXML);	
	}
]]>
</mx:Script>
    <mx:HTTPService
        id="svcSearch"
        resultFormat="e4x"
        result="handleSearchListResult(event)"/>
		
	<mx:XMLListCollection 
		id="patientsXLC"
		source="{XMLList(svcSearch.lastResult.children())}"/>
	
	<mx:HBox>
		<mx:Label fontWeight="bold" text="Search by Name: "></mx:Label>
		<mx:TextInput id="searchTI"/>
		<mx:Button id="searchButton" label="Search" click="search()"/>
		<mx:Button id="showAllButton" label="Show All" click="showAll()"/>
	</mx:HBox>
	
	<mx:DataGrid id="patientsGrid" width="80%" height="100%" dataProvider="{patientsXLC}">
        <mx:columns>
        	<mx:DataGridColumn headerText="First Name" width="300"
                dataField="first_name"/>
            <mx:DataGridColumn headerText="Last Name" width="300"
                dataField="last_name"/>
        	<mx:DataGridColumn headerText="Gender" width="300"
                dataField="gender"/>                
        </mx:columns>
    </mx:DataGrid>
	
</mx:VBox>
